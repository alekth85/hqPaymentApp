<?php

class pay()
{
    public function paypal()
    {
        $payer = new Payer();
        $payer->setPaymentMethod("paypal");

        $item1 = new Item();
        $item1->setName($_POST['item'])
              ->setCurrency($_POST['currency'])
              ->setQuantity($_POST['quantity'])
              ->setSku($_POST['sku']) // Similar to `item_number` in Classic API
              ->setPrice($_POST['price']);
      
        $itemList = new ItemList();
        $itemList->setItems(array($item1));

        $details = new Details();
        $details->setShipping($_POST['shipping']) 
                ->setTax($_POST['tax'])
                ->setSubtotal($_POST['subtotal']);

        $amount = new Amount();
        $amount->setCurrency($_POST['quantity'])
               ->setTotal($_POST['quantity'])  
               ->setDetails($details);

        $transaction = new Transaction();
        $transaction->setAmount($amount) 
                    ->setItemList($itemList)
                    ->setDescription("")
                    ->setInvoiceNumber(uniqid());
            
        $baseUrl = APP_URL;
        $redirectUrls = new RedirectUrls();
        $redirectUrls->setReturnUrl("$baseUrl/ExecutePayment.php?success=true")->setCancelUrl("$baseUrl/ExecutePayment.php?success=false");

        $payment = new Payment();
        $payment->setIntent("sale")
                ->setPayer($payer) 
                ->setRedirectUrls($redirectUrls)
        		->setTransactions(array($transaction));

        $request = clone $payment;

        try {
            $payment->create($apiContext);
        } catch (Exception $ex) {
            #ResultPrinter::printError("Created Payment Using PayPal. Please visit the URL to Approve.", "Payment", null, $request, $ex);
            var_dump("Created payment: " . $ex);
            return array(false, '');
        }
 
        return (true, $payment->getApprovalLink());
    }
    
    
}
		
